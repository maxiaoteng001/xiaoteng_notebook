<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.26">
    <title>models.py | Xiaoteng Notebook</title><meta name="description" content="Just playing around">
    <link rel="preload" href="/assets/js/runtime~app.c5a372b8.js" as="script"><link rel="preload" href="/assets/css/styles.cdce1c03.css" as="style"><link rel="preload" href="/assets/js/8690.2c4ac00b.js" as="script"><link rel="preload" href="/assets/js/app.6ff1040a.js" as="script">
    <link rel="stylesheet" href="/assets/css/styles.cdce1c03.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><img class="logo" src="/lion.jpeg" alt="Xiaoteng Notebook"><span class="site-name can-hide">Xiaoteng Notebook</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a href="/" class="nav-link" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/python/" class="nav-link router-link-active" aria-label="Python"><!--[--><!--]--> Python <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/vuepress/" class="nav-link" aria-label="Vuepress"><!--[--><!--]--> Vuepress <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a href="/" class="nav-link" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/python/" class="nav-link router-link-active" aria-label="Python"><!--[--><!--]--> Python <!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/vuepress/" class="nav-link" aria-label="Vuepress"><!--[--><!--]--> Vuepress <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><a href="/python/" class="nav-link router-link-active sidebar-heading sidebar-item" aria-label="Python"><!--[--><!--]--> Python <!--[--><!--]--></a><!----><!--]--><!--[--><a href="/python/python_basics" class="nav-link sidebar-heading sidebar-item" aria-label="Python basic"><!--[--><!--]--> Python basic <!--[--><!--]--></a><ul class=""><li><!--[--><a href="/python/python_basics/decorators.md" class="nav-link sidebar-item" aria-label="Decorators 装饰器"><!--[--><!--]--> Decorators 装饰器 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_basics/metaclasses.md" class="nav-link sidebar-item" aria-label="Metaclasses"><!--[--><!--]--> Metaclasses <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_basics/slice.md" class="nav-link sidebar-item" aria-label="Slice 切片"><!--[--><!--]--> Slice 切片 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_basics/tips.md" class="nav-link sidebar-item" aria-label="Tips"><!--[--><!--]--> Tips <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_basics/unittest.md" class="nav-link sidebar-item" aria-label="Unittest"><!--[--><!--]--> Unittest <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_basics/built_in_module" class="nav-link sidebar-item" aria-label="内置模块"><!--[--><!--]--> 内置模块 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a href="/python/python_basics/built_in_module/base64.md" class="nav-link sidebar-item" aria-label="Base64"><!--[--><!--]--> Base64 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_basics/built_in_module/csv-model.md" class="nav-link sidebar-item" aria-label="Csv 模块"><!--[--><!--]--> Csv 模块 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_basics/built_in_module/datetime.md" class="nav-link sidebar-item" aria-label="Datetime time"><!--[--><!--]--> Datetime time <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_basics/built_in_module/html.md" class="nav-link sidebar-item" aria-label="Html 实体"><!--[--><!--]--> Html 实体 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_basics/built_in_module/json.md" class="nav-link sidebar-item" aria-label="Json格式"><!--[--><!--]--> Json格式 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_basics/built_in_module/multiprocessing.md" class="nav-link sidebar-item" aria-label="Multiprocessing"><!--[--><!--]--> Multiprocessing <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_basics/built_in_module/os-model.md" class="nav-link sidebar-item" aria-label="Os model"><!--[--><!--]--> Os model <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_basics/built_in_module/logging.md" class="nav-link sidebar-item" aria-label="Python logging"><!--[--><!--]--> Python logging <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_basics/built_in_module/random.md" class="nav-link sidebar-item" aria-label="Random"><!--[--><!--]--> Random <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_basics/built_in_module/string.md" class="nav-link sidebar-item" aria-label="String 模块"><!--[--><!--]--> String 模块 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_basics/built_in_module/subprocess.md" class="nav-link sidebar-item" aria-label="Subprocess"><!--[--><!--]--> Subprocess <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_basics/built_in_module/sys.md" class="nav-link sidebar-item" aria-label="Sys"><!--[--><!--]--> Sys <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_basics/built_in_module/time.md" class="nav-link sidebar-item" aria-label="Time 模块"><!--[--><!--]--> Time 模块 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_basics/built_in_module/urllib.md" class="nav-link sidebar-item" aria-label="Urllib"><!--[--><!--]--> Urllib <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_basics/built_in_module/re-model.md" class="nav-link sidebar-item" aria-label="正则表达式"><!--[--><!--]--> 正则表达式 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a href="/python/python_basics/install.md" class="nav-link sidebar-item" aria-label="安装"><!--[--><!--]--> 安装 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_basics/exception.md" class="nav-link sidebar-item" aria-label="异常处理 exception"><!--[--><!--]--> 异常处理 exception <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_basics/data_structure.md" class="nav-link sidebar-item" aria-label="数据结构"><!--[--><!--]--> 数据结构 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_basics/modules" class="nav-link sidebar-item" aria-label="模块"><!--[--><!--]--> 模块 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a href="/python/python_basics/modules/apscheduler.md" class="nav-link sidebar-item" aria-label="Apscheduler"><!--[--><!--]--> Apscheduler <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_basics/modules/brotli.md" class="nav-link sidebar-item" aria-label="Brotli"><!--[--><!--]--> Brotli <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_basics/modules/httpx.md" class="nav-link sidebar-item" aria-label="Httpx"><!--[--><!--]--> Httpx <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_basics/modules/matplotlib.md" class="nav-link sidebar-item" aria-label="Matplotlib"><!--[--><!--]--> Matplotlib <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_basics/modules/paramiko.md" class="nav-link sidebar-item" aria-label="Paramiko 模块"><!--[--><!--]--> Paramiko 模块 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_basics/modules/pycryptodome.md" class="nav-link sidebar-item" aria-label="Pycryptodome 模块"><!--[--><!--]--> Pycryptodome 模块 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_basics/modules/pyexecjs.md" class="nav-link sidebar-item" aria-label="Pyexecjs python执行js代码"><!--[--><!--]--> Pyexecjs python执行js代码 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_basics/modules/pytesseract.md" class="nav-link sidebar-item" aria-label="Tesserocr ocr图片识别文字"><!--[--><!--]--> Tesserocr ocr图片识别文字 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_basics/modules/tesserocr.md" class="nav-link sidebar-item" aria-label="Tesserocr ocr图片识别文字"><!--[--><!--]--> Tesserocr ocr图片识别文字 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a href="/python/python_basics/encode.md" class="nav-link sidebar-item" aria-label="编码问题"><!--[--><!--]--> 编码问题 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_basics/process_thread_coroutine.md" class="nav-link sidebar-item" aria-label="进程 线程 和 协程"><!--[--><!--]--> 进程 线程 和 协程 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_basics/iteration_generator_iterable.md" class="nav-link sidebar-item" aria-label="迭代器 生成器 可迭代对象"><!--[--><!--]--> 迭代器 生成器 可迭代对象 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><a href="/python/python_web" class="nav-link router-link-active sidebar-heading sidebar-item active" aria-label="Python web"><!--[--><!--]--> Python web <!--[--><!--]--></a><ul class=""><li><!--[--><a href="/python/python_web/ajax.md" class="nav-link sidebar-item" aria-label="Ajax"><!--[--><!--]--> Ajax <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_web/celery" class="nav-link sidebar-item" aria-label="Celery"><!--[--><!--]--> Celery <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a href="/python/python_web/celery/index.md" class="nav-link sidebar-item" aria-label="Celery"><!--[--><!--]--> Celery <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a href="/python/python_web/django" class="nav-link router-link-active sidebar-item active" aria-label="Django"><!--[--><!--]--> Django <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a href="/python/python_web/django/django_admin.md" class="nav-link sidebar-item" aria-label="Admin"><!--[--><!--]--> Admin <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_web/django/apps.md" class="nav-link sidebar-item" aria-label="Apps"><!--[--><!--]--> Apps <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_web/django/models.md" class="nav-link sidebar-item active" aria-label="Models.py"><!--[--><!--]--> Models.py <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_web/django/more.md" class="nav-link sidebar-item" aria-label="More"><!--[--><!--]--> More <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_web/django/settings.md" class="nav-link sidebar-item" aria-label="Setting.py"><!--[--><!--]--> Setting.py <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_web/django/templates.md" class="nav-link sidebar-item" aria-label="Templates 模板"><!--[--><!--]--> Templates 模板 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_web/django/HTTP.md" class="nav-link sidebar-item" aria-label="Url"><!--[--><!--]--> Url <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_web/django/urls.md" class="nav-link sidebar-item" aria-label="Urls"><!--[--><!--]--> Urls <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_web/django/views.md" class="nav-link sidebar-item" aria-label="Views"><!--[--><!--]--> Views <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_web/django/django_start_up.md" class="nav-link sidebar-item" aria-label="开始一个项目"><!--[--><!--]--> 开始一个项目 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_web/django/static_files.md" class="nav-link sidebar-item" aria-label="静态文件"><!--[--><!--]--> 静态文件 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a href="/python/python_web/flask" class="nav-link sidebar-item" aria-label="Flask"><!--[--><!--]--> Flask <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_web/http" class="nav-link sidebar-item" aria-label="Http 协议"><!--[--><!--]--> Http 协议 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a href="/python/python_web/http/post.md" class="nav-link sidebar-item" aria-label="Post"><!--[--><!--]--> Post <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a href="/python/python_web/jinja.md" class="nav-link sidebar-item" aria-label="Jinja"><!--[--><!--]--> Jinja <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_web/python_wsgi.md" class="nav-link sidebar-item" aria-label="Python 应用服务器"><!--[--><!--]--> Python 应用服务器 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_web/restful.md" class="nav-link sidebar-item" aria-label="Restful api"><!--[--><!--]--> Restful api <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_web/websafe.md" class="nav-link sidebar-item" aria-label="Web应用安全"><!--[--><!--]--> Web应用安全 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_web/web_nginx.md" class="nav-link sidebar-item" aria-label="Web服务器nginx"><!--[--><!--]--> Web服务器nginx <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/python/python_web/venv.md" class="nav-link sidebar-item" aria-label="包管理和虚拟环境"><!--[--><!--]--> 包管理和虚拟环境 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="models-py" tabindex="-1"><a class="header-anchor" href="#models-py" aria-hidden="true">#</a> models.py</h1><p>[参考:<a href="https://www.cnblogs.com/sss4/p/7070942.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/sss4/p/7070942.html<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>]</p><h2 id="_0-前言" tabindex="-1"><a class="header-anchor" href="#_0-前言" aria-hidden="true">#</a> 0. 前言</h2><p>ORM是什么？：(在django中，根据代码中的类自动生成数据库的表也叫--code first)<br> ORM：Object Relational Mapping(关系对象映射)<br> 类名对应------》数据库中的表名<br> 类属性对应---------》数据库里的字段<br> 类实例对应---------》数据库表里的一行数据<br> obj.id obj.name.....类实例对象的属性</p><p>Django orm的优势：<br> Django的orm操作本质上会根据对接的数据库引擎，翻译成对应的sql语句；所有使用Django开发的项目无需关心程序底层使用的是MySQL、Oracle、sqlite....，如果数据库迁移，只需要更换Django的数据库引擎即可；</p><ol><li><p>新建或修改models的三步骤:</p><ol><li>Change your models (in models.py).</li><li>Run <code>python manage.py makemigrations</code> to create migrations for those changes</li><li>Run <code>python manage.py migrate</code> to apply those changes to the database.</li></ol></li><li><p>说明</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 生效models的创建和更改</span>
python manage.py makemigrations
python manage.py makemigrations polls   <span class="token comment"># 指定app</span>
<span class="token comment"># 查看modles sql, 不执行仅用于调试判断是否符合预期</span>
python manage.py sqlmigrate polls 0001  <span class="token comment"># 0001是更新历史</span>
<span class="token comment"># </span>
<span class="token comment"># 创建和更新表    `INSTALLED_APPS` 包含了一些默认组建方便使用, 这些组件可能需要使用数据库, 所以下列操作创建必要的表</span>
python manage.py migrate
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li></ol><h2 id="_1-初始化models" tabindex="-1"><a class="header-anchor" href="#_1-初始化models" aria-hidden="true">#</a> 1. 初始化Models</h2><p>创建models.py来表示数据库关系</p><ol><li><p>数据库关系</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>- ForeignKey  <span class="token comment"># 外键, 设置一对多, 例如: models.ForeignKey(User, on_delete=models.CASCADE)  # on_delete在1.10版本上不需要</span>
- ManyToManyField  <span class="token comment"># 多对多关系,tags = models.ManyToManyField(Tag, blank=True)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li><li><p>数据库内容类型</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token operator">-</span> CharField  <span class="token comment"># 字符串</span>
<span class="token operator">-</span> TextField  <span class="token comment"># 很长的字符串</span>
<span class="token operator">-</span> DateTimeField  <span class="token comment"># 时间日期</span>
<span class="token operator">-</span> DateField  <span class="token comment"># 日期</span>
<span class="token operator">-</span> 枚举字段
    choice<span class="token operator">=</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&#39;男人&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&#39;女人&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">&#39;其他&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    lover<span class="token operator">=</span>models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>choices<span class="token operator">=</span>choice<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li><li><p>内容参数</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token operator">-</span> max_length<span class="token operator">=</span><span class="token number">100</span>  
<span class="token operator">-</span> blank<span class="token operator">=</span><span class="token boolean">True</span> <span class="token comment"># 默认False</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li><li><p>例子</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models
<span class="token keyword">class</span> <span class="token class-name">Post</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 文章标题</span>
    tille <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">70</span><span class="token punctuation">)</span>
    body <span class="token operator">=</span> models<span class="token punctuation">.</span>TextField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    modified_time <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    category <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>Category<span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span>
    tags <span class="token operator">=</span> models<span class="token punctuation">.</span>ManyToManyField<span class="token punctuation">(</span>Tag<span class="token punctuation">,</span> blank<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li><li><p>内置Model</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token comment"># django.contrib.auth 是 Django 内置的应用，专门用于处理网站用户的注册、登录等流程，User 是 Django 为我们已经写好的用户模型。</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>models <span class="token keyword">import</span> User
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li><li><p>外键的创建</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>people_id <span class="token operator">=</span> ForeignKey<span class="token punctuation">(</span>XX<span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span> 
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></li></ol><h2 id="_2-django操作数据库" tabindex="-1"><a class="header-anchor" href="#_2-django操作数据库" aria-hidden="true">#</a> 2. Django操作数据库</h2><ol><li><p>增</p><ul><li><p>增加单个</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>    <span class="token comment"># 方法一</span>
    <span class="token keyword">from</span> blog<span class="token punctuation">.</span>models <span class="token keyword">import</span> Tag
    p1 <span class="token operator">=</span> Publisher<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&#39;Apress&#39;</span><span class="token punctuation">,</span> address<span class="token operator">=</span><span class="token string">&#39;2855 Telegraph Avenue&#39;</span><span class="token punctuation">,</span>city<span class="token operator">=</span><span class="token string">&#39;Berkeley&#39;</span><span class="token punctuation">,</span> state_province<span class="token operator">=</span><span class="token string">&#39;CA&#39;</span><span class="token punctuation">,</span> country<span class="token operator">=</span><span class="token string">&#39;U.S.A.&#39;</span><span class="token punctuation">,</span>website<span class="token operator">=</span><span class="token string">&#39;http://www.apress.com/&#39;</span><span class="token punctuation">)</span>
    p1<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 方法二</span>
    p1 <span class="token operator">=</span> Publisher<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&#39;Apress&#39;</span><span class="token punctuation">,</span>address<span class="token operator">=</span><span class="token string">&#39;2855 Telegraph Avenue&#39;</span><span class="token punctuation">,</span>city<span class="token operator">=</span><span class="token string">&#39;Berkeley&#39;</span><span class="token punctuation">,</span>state_province<span class="token operator">=</span><span class="token string">&#39;CA&#39;</span><span class="token punctuation">,</span> country<span class="token operator">=</span><span class="token string">&#39;U.S.A.&#39;</span><span class="token punctuation">,</span>website<span class="token operator">=</span><span class="token string">&#39;http://www.apress.com/&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li><li><p>批量增加</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>    t1 <span class="token operator">=</span> Tag<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&#39;name1&#39;</span><span class="token punctuation">)</span>
    t2 <span class="token operator">=</span> Tag<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&#39;name2&#39;</span><span class="token punctuation">)</span>
    t3 <span class="token operator">=</span> Tag<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&#39;name3&#39;</span><span class="token punctuation">)</span>
    t4 <span class="token operator">=</span> Tag<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&#39;name4&#39;</span><span class="token punctuation">)</span>
    tags <span class="token operator">=</span> <span class="token punctuation">[</span>t1<span class="token punctuation">,</span> t2<span class="token punctuation">,</span> t3<span class="token punctuation">,</span> t4<span class="token punctuation">]</span>
    TAG<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>bulk_create<span class="token punctuation">(</span>tags<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ul></li><li><p>查</p><ol><li><p>查询全部</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>    Tag<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token operator">&gt;</span> <span class="token operator">&lt;</span>QuerySet <span class="token punctuation">[</span><span class="token operator">&lt;</span>Tag<span class="token punctuation">:</span> Tag <span class="token builtin">object</span><span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>  <span class="token comment"># 返回类型</span>
    <span class="token comment"># 可迭代类型,每个都是model实例</span>
    <span class="token comment"># 返回list, 每个是dict</span>
    Tag<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 返回list, 每个是list, 只保留value</span>
    Tag<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values_list<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li><li><p>条件查询</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>    t <span class="token operator">=</span> Tag<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">&#39;test&#39;</span><span class="token punctuation">)</span>  <span class="token comment"># 返回一条数据, 当有多条或没有错误, 抛出异常</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></li><li><p>where 或 where not 查询</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>    t <span class="token operator">=</span> Tag<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>condition<span class="token punctuation">)</span> 
    t <span class="token operator">=</span> Tag<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>exclude<span class="token punctuation">(</span>condition<span class="token punctuation">)</span>
    <span class="token comment"># condition语句支持 = 大于 小于, 与或非操作 </span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li><li><p>连锁查询 需要同时进行过滤和排序查询的操作时，可以简单地写成这种“链式”的形式：</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>    Publisher<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>country<span class="token operator">=</span><span class="token string">&quot;U.S.A.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>order_by<span class="token punctuation">(</span><span class="token string">&quot;-name&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">[</span><span class="token operator">&lt;</span>Publisher<span class="token punctuation">:</span> O&#39;Reilly<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>Publisher<span class="token punctuation">:</span> Apress<span class="token operator">&gt;</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li><li><p>限制返回的语句</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>    <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Publisher<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>order_by<span class="token punctuation">(</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token operator">&lt;</span>Publisher<span class="token punctuation">:</span> Apress<span class="token operator">&gt;</span>

    <span class="token comment"># 类似的，可以用Python的range-slicing语法来取出数据的特定子集：</span>
    <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Publisher<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>order_by<span class="token punctuation">(</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>
    <span class="token comment"># 这个例子返回两个对象，等同于以下的SQL语句：</span>
    SELECT <span class="token builtin">id</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> address<span class="token punctuation">,</span> city<span class="token punctuation">,</span> state_province<span class="token punctuation">,</span> country<span class="token punctuation">,</span> website
    FROM books_publisher
    ORDER BY name
    OFFSET <span class="token number">0</span> LIMIT <span class="token number">2</span><span class="token punctuation">;</span>

    <span class="token comment"># 注意，不支持Python的负索引(negative slicing)：</span>
    <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Publisher<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>order_by<span class="token punctuation">(</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    AssertionError<span class="token punctuation">:</span> Negative indexing <span class="token keyword">is</span> <span class="token keyword">not</span> supported<span class="token punctuation">.</span>

    <span class="token comment"># 虽然不支持负索引，但是可以使用其他的方法。 比如，修改order_by() 语句来实现：</span>
    <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Publisher<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>order_by<span class="token punctuation">(</span><span class="token string">&#39;-name&#39;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div></li></ol></li><li><p>改, 更新</p><ol><li><p>save()方法</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>    <span class="token comment"># save方法将会更新对象的所有信息,不管有没有更改</span>
    t <span class="token operator">=</span> Tag<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&#39;test&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span>age<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span>
    t<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&#39;new_name&#39;</span>
    t<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 等效SQL</span>
    UPDATE books_publisher SET
        name <span class="token operator">=</span> <span class="token string">&#39;Apress Publishing&#39;</span><span class="token punctuation">,</span>
        address <span class="token operator">=</span> <span class="token string">&#39;2855 Telegraph Ave.&#39;</span><span class="token punctuation">,</span>
        city <span class="token operator">=</span> <span class="token string">&#39;Berkeley&#39;</span><span class="token punctuation">,</span>
        state_province <span class="token operator">=</span> <span class="token string">&#39;CA&#39;</span><span class="token punctuation">,</span>
        country <span class="token operator">=</span> <span class="token string">&#39;U.S.A.&#39;</span><span class="token punctuation">,</span>
        website <span class="token operator">=</span> <span class="token string">&#39;http://www.apress.com&#39;</span>
    WHERE <span class="token builtin">id</span> <span class="token operator">=</span> <span class="token number">52</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li><li><p>update()方法</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>    Publisher<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">52</span><span class="token punctuation">)</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&#39;Apress Publishing&#39;</span><span class="token punctuation">)</span>
    <span class="token comment"># update()对任何结果集都有效,可以同时更新多条</span>
    Publisher<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span>country<span class="token operator">=</span><span class="token string">&#39;USA&#39;</span><span class="token punctuation">)</span>

    <span class="token comment"># 等效SQL语句</span>
    UPDATE books_publisher 
        SET name <span class="token operator">=</span> <span class="token string">&#39;Apress Publishing&#39;</span> 
    WHERE <span class="token builtin">id</span> <span class="token operator">=</span> <span class="token number">52</span><span class="token punctuation">;</span>

    <span class="token comment"># 返回一个int型,表示更改的条数</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li></ol></li><li><p>删</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>    <span class="token comment"># 删除数据库中的对象只需调用该对象的delete()方法即可：</span>
    <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> p <span class="token operator">=</span> Publisher<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;O&#39;Reilly&quot;</span><span class="token punctuation">)</span>
    <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> p<span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Publisher<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">[</span><span class="token operator">&lt;</span>Publisher<span class="token punctuation">:</span> Apress Publishing<span class="token operator">&gt;</span><span class="token punctuation">]</span>    <span class="token comment">#少了一条记录</span>

    <span class="token comment"># 同样我们可以在结果集上调用delete()方法同时删除多条记录。这一点与我们上一小节提到的update()方法相似：</span>
    <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Publisher<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>country<span class="token operator">=</span><span class="token string">&#39;USA&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Publisher<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Publisher<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token comment"># 删除数据时要谨慎！ 为了预防误删除掉某一个表内的所有数据，Django要求在删除表内所有数据时显示使用all()。</span>
    <span class="token comment"># 比如，下面的操作将会出错：</span>
    <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Publisher<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>
    Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
    File <span class="token string">&quot;&lt;console&gt;&quot;</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">&gt;</span>
    AttributeError<span class="token punctuation">:</span> <span class="token string">&#39;Manager&#39;</span> <span class="token builtin">object</span> has no attribute <span class="token string">&#39;delete&#39;</span>

    <span class="token comment"># 而一旦使用all()方法，所有数据将会被删除：</span>
    <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Publisher<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 如果只需要删除部分的数据，就不需要调用all()方法。再看一下之前的例子：</span>
    <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Publisher<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>country<span class="token operator">=</span><span class="token string">&#39;USA&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div></li><li><p>排序</p><ol><li>自定义排序</li></ol><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>    <span class="token comment"># 升序排列：</span>
    <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Publisher<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>order_by<span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">[</span><span class="token operator">&lt;</span>Publisher<span class="token punctuation">:</span> Apress<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>Publisher<span class="token punctuation">:</span> O&#39;Reilly<span class="token operator">&gt;</span><span class="token punctuation">]</span>

    <span class="token comment"># 降序排列：</span>
    <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Publisher<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>order_by<span class="token punctuation">(</span><span class="token string">&quot;-name&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">[</span><span class="token operator">&lt;</span>Publisher<span class="token punctuation">:</span> O&#39;Reilly<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>Publisher<span class="token punctuation">:</span> Apress<span class="token operator">&gt;</span><span class="token punctuation">]</span>

    <span class="token comment"># 按多个字段排列（第二个字段会在第一个字段的值相同的情况下被使用到）：</span>
    <span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Publisher<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>order_by<span class="token punctuation">(</span><span class="token string">&quot;state_province&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;address&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">[</span><span class="token operator">&lt;</span>Publisher<span class="token punctuation">:</span> Apress<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>Publisher<span class="token punctuation">:</span> O&#39;Reilly<span class="token operator">&gt;</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ol><li>缺省默认排序</li></ol><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code>    <span class="token keyword">class</span> <span class="token class-name">Publisher</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
        name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>
        address <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span>
        city <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">60</span><span class="token punctuation">)</span>
        state_province <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>
        country <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span>
        website <span class="token operator">=</span> models<span class="token punctuation">.</span>URLField<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">def</span> <span class="token function">__unicode__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>name

        <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
            ordering <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">]</span>
        <span class="token comment"># 你可以在任意一个 模型 类中使用 Meta 类，来设置一些与特定模型相关的选项。 如果你设置了ordering这个选项，那么除非你检索时特意额外地使用了 order_by()，</span>
        否则，当你使用 Django 的数据库 API 去检索时，Publisher对象的相关返回值默认地都会按 name 字段排序。
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div></li></ol><h2 id="_3-django中的q对象和复杂查询" tabindex="-1"><a class="header-anchor" href="#_3-django中的q对象和复杂查询" aria-hidden="true">#</a> 3. Django中的Q对象和复杂查询</h2><ol><li><p>多次查询</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token comment"># 一般我们在Django程序中查询数据库操作都是在QuerySet里进行进行，例如下面代码:</span>

<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> q1 <span class="token operator">=</span> Entry<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>headline__startswith<span class="token operator">=</span><span class="token string">&quot;What&quot;</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> q2 <span class="token operator">=</span> q1<span class="token punctuation">.</span>exclude<span class="token punctuation">(</span>pub_date__gte<span class="token operator">=</span>datetime<span class="token punctuation">.</span>date<span class="token punctuation">.</span>today<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> q3 <span class="token operator">=</span> q1<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pub_date__gte<span class="token operator">=</span>datetime<span class="token punctuation">.</span>date<span class="token punctuation">.</span>today<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li><li><p>组合</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token comment"># 两个Q默认为and的关系</span>
News<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>
    Q<span class="token punctuation">(</span>question__startswith<span class="token operator">=</span><span class="token string">&#39;Who&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Q<span class="token punctuation">(</span>pub_date<span class="token operator">=</span>date<span class="token punctuation">(</span><span class="token number">2005</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">|</span> Q<span class="token punctuation">(</span>pub_date<span class="token operator">=</span>date<span class="token punctuation">(</span><span class="token number">2005</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>

<span class="token comment"># 等价SQL语句</span>
SELECT <span class="token operator">*</span> <span class="token keyword">from</span> news
WHERE question LIKE <span class="token string">&#39;Who%&#39;</span>  AND <span class="token punctuation">(</span>pub_date <span class="token operator">=</span> <span class="token string">&#39;2005-05-02&#39;</span> ORpub_date <span class="token operator">=</span> <span class="token string">&#39;2005-05-06&#39;</span><span class="token punctuation">)</span>


<span class="token comment"># Q语句结合关键字查询时,需要关键字在前</span>
<span class="token comment">#正确的做法</span>
News<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>
    Q<span class="token punctuation">(</span>pub_date<span class="token operator">=</span>date<span class="token punctuation">(</span><span class="token number">2005</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">|</span> Q<span class="token punctuation">(</span>pub_date<span class="token operator">=</span>date<span class="token punctuation">(</span><span class="token number">2005</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    question__startswith<span class="token operator">=</span><span class="token string">&#39;Who&#39;</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div></li></ol><h2 id="_4-选择数据库版本" tabindex="-1"><a class="header-anchor" href="#_4-选择数据库版本" aria-hidden="true">#</a> 4. 选择数据库版本</h2><p>见设置文件</p><h2 id="_5-安全操作" tabindex="-1"><a class="header-anchor" href="#_5-安全操作" aria-hidden="true">#</a> 5. 安全操作</h2><ol><li><p>Avoiding race conditions using F()</p><div class="language-python ext-py line-numbers-mode"><pre class="language-python"><code><span class="token comment"># 数据库级别操作 </span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> F
reporter <span class="token operator">=</span> Reporters<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&#39;Tintin&#39;</span><span class="token punctuation">)</span>
reporter<span class="token punctuation">.</span>stories_filed <span class="token operator">=</span> F<span class="token punctuation">(</span><span class="token string">&#39;stories_filed&#39;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
reporter<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ol><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><span class="meta-item-info">9/17/2021, 6:55:21 PM</span></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: jizhuwo00@hotmail.com">maxiaoteng</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script src="/assets/js/runtime~app.c5a372b8.js" defer></script><script src="/assets/js/8690.2c4ac00b.js" defer></script><script src="/assets/js/app.6ff1040a.js" defer></script>
  </body>
</html>
